<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.prime.com.tr/ui" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:m="http://www.ol4jsf.org"
	template="/template/main.xhtml">

	<ui:define name="body">
		<h:form>
			<p:toolbar>
				<p:toolbarGroup align="left">
					<p:commandButton title="#{messages['button.new']}" image="ui-icon-document" action="#{contactListMB.getNextView}"
						actionListener="#{contactListMB.clear}" ajax="false" />

					<p:commandButton title="#{messages['button.delete']}" image="ui-icon-trash" onclick="confirmation.show()"
						type="button" immediate="true" ajax="false" />

					<p:confirmDialog message="#{messages['label.confirm.delete']}" showEffect="bounce" hideEffect="explode"
						header="#{messages['label.dialog.alert']}!" severity="alert" widgetVar="confirmation">

						<h:commandButton value="#{messages['button.dialog.yes']}" action="#{contactListMB.deleteSelection}"
							actionListener="#{contactListMB.clear}" />
						<h:commandButton value="#{messages['button.dialog.no']}" onclick="confirmation.hide()" type="button" />
					</p:confirmDialog>
				</p:toolbarGroup>
				<p:toolbarGroup align="right">
				<p:commandButton title="#{messages['button.kml']}" image="icon-kml" ajax="false" >
					<p:fileDownload value="#{contactListMB.kml}" />
				</p:commandButton>
				<p:commandButton title="#{messages['button.shapefile']}" image="icon-shapefile" ajax="false" >
					<p:fileDownload value="#{contactListMB.shapefile}" />
				</p:commandButton>
				</p:toolbarGroup>
			</p:toolbar>

			<p:dataTable id="list" var="bean" value="#{contactListMB.resultList}">
				<f:facet name="header">#{messages['contact.list.table.title']}</f:facet>
				<p:column style="width:5%;">
					<h:selectBooleanCheckbox value="#{contactListMB.selection[bean.id]}"></h:selectBooleanCheckbox>
				</p:column>
				<p:column style="width:5%;" sortBy="#{bean.id}">
					<f:facet name="header">#{messages['contact.label.id']}</f:facet>
					<h:outputText value="#{bean.id}" />
				</p:column>
				<p:column sortBy="#{bean.name}">
					<f:facet name="header">#{messages['contact.label.name']}</f:facet>
					<h:commandLink action="#{contactListMB.getNextView}" actionListener="#{contactListMB.clear}">
						<h:outputText value="#{bean.name}" />
						<f:param name="id" value="#{bean.id}" />
					</h:commandLink>
				</p:column>
				<p:column sortBy="#{bean.telephone}">
					<f:facet name="header">#{messages['contact.label.telefone']}</f:facet>
					<h:commandLink action="#{contactListMB.getNextView}" actionListener="#{contactListMB.clear}">
						<h:outputText value="#{bean.telephone}" />
						<f:param name="id" value="#{bean.id}"/>
					</h:commandLink>
				</p:column>
					<p:column style="width:5%;">
					<p:commandButton value="Map" onclick="map.setCenter(new OpenLayers.LonLat(#{bean.point.centroid.x}, #{bean.point.centroid.y}), map.getZoom());" type="button"/>
				</p:column>
			</p:dataTable>
			<div id="box_mapa">
			<div id="toolbar" >
			<div id="toolbar_group"></div>
			</div>
			<m:map id="map" width="1000" height="400" jsVariable="map" 
				options="{
					
					controls: [],
					numZoomLevels: 20,
					units: 'dd',
					maxResolution: 'auto'
					
						}">	
	             <m:wmsLayer name="OpenLayers WMS"
	                         url="http://localhost:8080/geoserver/topp/wms"
	                         params="{layers:'topp:states'}" />
	             	<m:layerSwitcherControl />
	              	<m:navigationControl />
	                <m:panZoomBarControl />
	                <m:layerSwitcherControl options="{ascending:false}"/>
	                <m:scaleLineControl />
	                <m:mousePositionControl />
	                <m:overviewMapControl />
	                <m:keyboardDefaultsControl />
	                <m:permalinkControl />	                
					<m:vectorLayer name="Features" value="#{contactListMB.resultFeatureList}" jsVariable="features"/>
					
					  
					<m:panelControl options="{div:document.getElementById('toolbar_group')}" jsVariable="toolbar">
						<m:zoomToMaxExtentControl options="{title:'Reset Zoom Map'}"/>
					</m:panelControl>
					<m:script>toolbar.addControls(new OpenLayers.Control.MouseDefaults({title:'Pan'}));</m:script>
					<m:script>toolbar.addControls(new OpenLayers.Control.ZoomBox({alwaysZoom:true, title:'Zoom box'}));</m:script>
					<m:script>toolbar.addControls(new OpenLayers.Control.ZoomIn({title:'Zoom in'}));</m:script>   
					<m:script>toolbar.addControls(new OpenLayers.Control.ZoomOut({title:'Zoom out'}));</m:script>
					<m:script>map.zoomToExtent(features.getDataExtent());</m:script>
         		</m:map>
         		</div>
         		<script type="text/javascript">
         		
         		//for (var i in map_ol.layers[2].features){ alert(map_ol.layers[2].features[i]);}
         			//alert(map_ol.layers);	
         		</script>
         		
			
		</h:form>
	</ui:define>
</ui:composition>